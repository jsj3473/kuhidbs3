<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>조합 재무정보 등록</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="container mt-4">

<h2 class="mb-4">조합 재무정보 등록</h2>

<form id="fundFinancialAddForm">
    <input type="hidden" id="fundId" name="fundId" th:value="${fundId}" />

    <div class="mb-3">
        <label class="form-label">회계연도</label>
        <input type="month" class="form-control" id="financialYear">
    </div>

    <!-- 재무 상태 -->
    <div class="card mt-4">
        <div class="card-header">재무 상태</div>
        <div class="card-body">
            <table class="table">
                <tr><td>창투자산</td><td><input type="text" class="form-control number-format" id="ventureAssets"></td></tr>
                <tr><td>기타자산</td><td><input type="text" class="form-control number-format" id="otherAssets"></td></tr>
                <tr><td>자산총계</td><td><input type="text" class="form-control number-format" id="totalAssets"></td></tr>
                <tr><td>유동부채</td><td><input type="text" class="form-control number-format" id="currentLiabilities"></td></tr>
                <tr><td>기타부채</td><td><input type="text" class="form-control number-format" id="otherLiabilities"></td></tr>
                <tr><td>부채총계</td><td><input type="text" class="form-control number-format" id="totalLiabilities"></td></tr>
                <tr><td>출자금</td><td><input type="text" class="form-control number-format" id="capital"></td></tr>
                <tr><td>이익잉여</td><td><input type="text" class="form-control number-format" id="retainedEarnings"></td></tr>
                <tr><td>자본총계</td><td><input type="text" class="form-control number-format" id="totalCapital"></td></tr>
            </table>
        </div>
    </div>

    <!-- 손익 계산 -->
    <div class="card mt-4">
        <div class="card-header">손익 계산</div>
        <div class="card-body">
            <table class="table">
                <tr><td>영업수익</td><td><input type="text" class="form-control number-format" id="operatingRevenue"></td></tr>
                <tr><td>영업비용</td><td><input type="text" class="form-control number-format" id="operatingExpense"></td></tr>
                <tr><td>당기순이익</td><td><input type="text" class="form-control number-format" id="netProfit"></td></tr>
            </table>
        </div>
    </div>

    <!-- 영업비용 상세 -->
    <div class="card mt-4">
        <div class="card-header">영업비용 상세</div>
        <div class="card-body">
            <table class="table">
                <tr><td>투자주식손상차손</td><td><input type="text" class="form-control number-format" id="investmentImpairmentLoss"></td></tr>
                <tr><td>관리보수</td><td><input type="text" class="form-control number-format" id="managementFee"></td></tr>
                <tr><td>성과보수</td><td><input type="text" class="form-control number-format" id="performanceFee"></td></tr>
                <tr><td>수탁관리보수</td><td><input type="text" class="form-control number-format" id="custodyManagementFee"></td></tr>
                <tr><td>회계감사수수료</td><td><input type="text" class="form-control number-format" id="auditFee"></td></tr>
                <tr><td>기타 비용</td><td><input type="text" class="form-control number-format" id="miscExpense"></td></tr>
            </table>
        </div>
    </div>

    <div class="text-end mt-4">
        <button type="submit" class="btn btn-primary">저장</button>
    </div>
</form>

</body>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll(".number-format").forEach(input => {
            input.addEventListener("input", function () {
                this.value = this.value.replace(/[^0-9.]/g, "").replace(/(\..*)\./g, "$1");
                this.value = this.value.replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            });
        });

        document.getElementById("fundFinancialAddForm").addEventListener("submit", function (event) {
            event.preventDefault();

            let formData = {};
            document.querySelectorAll(".number-format").forEach(input => {
                formData[input.id] = input.value.replace(/,/g, "");
            });

            formData["fundId"] = document.getElementById("fundId")?.value.trim() || "";
            formData["financialYear"] = document.getElementById("financialYear")?.value.trim() || "";

            fetch("/api/funds/createFundFinancial", {
                method: "POST",
                credentials: "include",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(formData)
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error("저장 실패");
                    }
                    return response.json();
                })
                .then(data => {
                    alert("재무 정보가 저장되었습니다.");
                    document.getElementById("fundFinancialAddForm").reset();
                })
                .catch(error => {
                    alert("저장 중 오류 발생: " + error.message);
                });
        });
    });
</script>
</html>
