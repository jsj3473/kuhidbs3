<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¡°í•©ì •ë³´ì¡°íšŒ</title>

    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
    <script defer th:src="@{/js/bootstrap.bundle.min.js}"></script>
    <link rel="stylesheet" th:href="@{/css/datatables-custom.css}">
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{/css/sidebar.css}">
    <link rel="stylesheet" th:href="@{/css/navbar.css}">
    <link rel="stylesheet" th:href="@{/css/slimTable.css}">
    <script th:src="@{/js/common.js}"></script>
    <script defer th:src="@{/js/searchModal.js}"></script>

    <style></style>
    <script>
        function fetchFundInfo(fundId) {
            fetch(`/api/funds/info/${fundId}`)
                .then(response => response.json())
                .then(data => updateFundInfo(data))
                .catch(error => console.error("ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:", error));
        }

        function updateFundInfo(data) {
            document.getElementById("fundId").value = data.fundId || "";
            document.getElementById("liquidationStatus").value = data.liquidationStatus || "";
            document.getElementById("liquidationDate").value = data.liquidationDate || "";
            document.getElementById("fundName").value = data.fundName || "";
            document.getElementById("fundNameDetail").value = data.fundNameDetail || "";
            document.getElementById("establishmentDate").value = data.establishmentDate || "";
            document.getElementById("duration").value = data.duration || "";
            document.getElementById("durationStartDate").value = data.durationStartDate || "";
            document.getElementById("durationEndDate").value = data.durationEndDate || "";
            document.getElementById("investmentDuration").value = data.investmentDuration || "";
            document.getElementById("investmentStartDate").value = data.investmentStartDate || "";
            document.getElementById("investmentEndDate").value = data.investmentEndDate || "";
            document.getElementById("committedTotalPrice").value = formatNumber(data.committedTotalPrice);
            document.getElementById("unitPrice").value = formatNumber(data.unitPrice);
            document.getElementById("fundOrganizationType").value = data.fundOrganizationType || "";
            document.getElementById("paymentType").value = data.paymentType || "";
            document.getElementById("currentStaff").value = data.currentStaff || "";
            document.getElementById("auditorName").value = data.auditorName || "";
            document.getElementById("auditorDate").value = data.auditorDate || "";
            document.getElementById("trusteeCorporation").value = data.trusteeCorporation || "";
            document.getElementById("administrationCorporation").value = data.administrationCorporation || "";
            document.getElementById("targetReturnRate").value = data.targetReturnRate || "";
            document.getElementById("performanceFeeRate").value = data.performanceFeeRate || "";
            document.getElementById("managementFeeInvestmentPeriod").value = data.managementFeeInvestmentPeriod || "";
            document.getElementById("managementFeeManagementPeriod").value = data.managementFeeManagementPeriod || "";
            // document.getElementById("agreementCriteria").value = data.agreementCriteria || "";
            document.getElementById("incentiveCondition").value = data.incentiveCondition || "";
            document.getElementById("priorLossGP").value = data.priorLossGP || "";
            document.getElementById("priorLossLP").value = data.priorLossLP || "";

            updateFundMembersTable(data.fundMems);
        }

        function updateFundMembersTable(fundMems) {
            const tableBody = document.getElementById("fundMembersTable");
            tableBody.innerHTML = "";

            fundMems.forEach(member => {
                const row = `<tr>
            <td>${member.memberName || ""}</td>
            <td>${member.memberType || ""}</td>
            <td>${formatNumber(member.committedUnitPrice)}</td>
            <td>${member.contact || ""}</td>
            <td>${member.address || ""}</td>
            <td>${member.businessRegNo || ""}</td>
            <td>${member.residentRegNo || ""}</td>
        </tr>`;
                tableBody.innerHTML += row;
            });
        }

        function formatNumber(value) {
            if (!value) return "";
            return Number(value).toLocaleString(); // ì²œ ë‹¨ìœ„ ì½¤ë§ˆ ì¶”ê°€
        }

        document.addEventListener("DOMContentLoaded", function () {
            let fundId = document.getElementById("fundIdValue").value;
            if (fundId) {
                fetchFundInfo(fundId);
            }
        });

    </script>


    <script defer>
        document.addEventListener("DOMContentLoaded", function () {
            // âœ… fundId ê°’ì„ hidden inputì—ì„œ ê°€ì ¸ì˜¤ê¸°
            let fundIdInput = document.getElementById("fundIdValue");
            let fundId = fundIdInput ? fundIdInput.value : null;

            console.log("âœ… fundId:", fundId);

            if (fundId) {
                window.fundId = fundId; // âœ… ì „ì—­ ë³€ìˆ˜ì— ì €ì¥
                fetchFundInfo(fundId); // âœ… íšŒì‚¬ ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸°
            } else {
                console.warn("âš ï¸ fundIdë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            }
            // ì…ë ¥ íŒì—… ì—´ê¸° í•¨ìˆ˜
            // íŒì—… ì—´ê¸° í•¨ìˆ˜
            window.openPopup = function (type) {
                if (!window.fundId) {
                    alert("ë¨¼ì € ì¡°í•© ì •ë³´ë¥¼ ì¡°íšŒí•œ í›„ ì…ë ¥í•˜ì„¸ìš”.");
                    return;
                }
                let url = `/fundAdd/${type}/${window.fundId}`;
                window.open(url, "popupWindow", "width=700,height=500,scrollbars=yes");
            };
            // ğŸ”¥ ì¡°íšŒ íŒì—… ì—´ê¸° í•¨ìˆ˜
            window.openViewPopup = function (type) {
                if (!window.fundId) {
                    alert("ë¨¼ì € ê¸°ì—… ì •ë³´ë¥¼ ì¡°íšŒí•œ í›„ í™•ì¸í•˜ì„¸ìš”.");
                    return;
                }
                let url = `/fundShow/${type}/${window.fundId}`;
                window.open(url, "popupWindow", "width=1500,height=600,scrollbars=yes");
            };
        });
    </script>

</head>
<body>

<div th:replace="fragments/navbar :: navbar"></div>
<div th:replace="fragments/searchModal :: searchModal"></div>


<div class="wrapper">

    <input type="hidden" id="fundIdValue" th:value="${fundId}" />

    <!-- ğŸ“Œ ì¢Œì¸¡ ì‚¬ì´ë“œë°” -->
    <nav class="sidebar">
        <a href="#" onclick="openPopup('audit')">ğŸ§‘ğŸ»â€ğŸ’¼ íšŒê³„ê°ì‚¬ì¸ ê´€ë¦¬</a>
        <a href="#" onclick="openViewPopup('auditsByFund')">ğŸ§‘ğŸ»â€ğŸ’¼ íšŒê³„ê°ì‚¬ì¸ ì´ë ¥ì¡°íšŒ</a>
        <a href="#" onclick="openPopup('staff')">ğŸ’¼ ìš´ìš©ì¸ë ¥ ê´€ë¦¬</a>
        <a href="#" onclick="openViewPopup('staffsByFund')">ğŸ’¼ ìš´ìš©ì¸ë ¥ ì´ë ¥ì¡°íšŒ</a>
        <a href="#" onclick="openPopup('fundFinancial')">ğŸ—‚ï¸ ì¬ë¬´ì œí‘œ ê´€ë¦¬</a>
        <a href="#" onclick="openViewPopup('financialsByFund')">ğŸ—‚ï¸ ì¬ë¬´ì œí‘œ ì´ë ¥ì¡°íšŒ</a>
<!--        <a href="#" onclick="openViewPopup('members')">ğŸ‘¤ íˆ¬ìì¡°í•©ì› ê´€ë¦¬</a>-->
        <a href="#" onclick="openViewPopup('membersByFund')">ğŸ‘¤ íˆ¬ìì¡°í•©ì› ë³€ê²½ãƒ»ì¡°íšŒ</a>
        <a href="#" onclick="openViewPopup('IASByfund')">ğŸ’° íˆ¬ììì‚°ì´ê´„í‘œ ì¡°íšŒ</a>
<!--        <a href="#" onclick="openViewPopup('#')">ğŸªª íˆ¬ìì¡°í•©í‰ê°€ê²°ê³¼ ì¡°íšŒ</a>-->
        <a href="#" onclick="openViewPopup('dueDiligenceByFund')">ğŸ” íˆ¬ìê¸°ì—…ì‹¤ì‚¬ ì¡°íšŒ</a>
        <a href="#" onclick="openViewPopup('empChangeByFund')">ğŸ‘¥ íˆ¬ìê¸°ì—…ê³ ìš©ë³€ê²½ ì¡°íšŒ</a>
    </nav>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            let fundId = document.getElementById("fundIdValue").value;
            console.log("âœ… fundId:", fundId);
            if (fundId) {
                fetchFundInfo(fundId);
            }
        });
    </script>
    <!-- ğŸ“Œ ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ -->
    <div class="content">
        <h2>ğŸ¦ ì¡°í•© ì •ë³´ ì¡°íšŒ</h2>
        <!-- 1. íšŒì‚¬ ê¸°ë³¸ ì •ë³´ -->
        <table class="table table-bordered text-center">
            <thead>
            <tr><th colspan="7">íˆ¬ìì¡°í•© ê³ ìœ ì •ë³´</th></tr>
            </thead>
            <tbody>
            <tr>
                <th>ì¡°í•© ê³ ìœ ë²ˆí˜¸</th>
                <td colspan="2"><input type="text" class="form-control" name="fundId" id="fundId" readonly></td>
                <th>ì²­ì‚°ì—¬ë¶€</th>
                <td>
                    <select class="form-control" name="liquidationStatus" disabled>
                        <option value="">ì„ íƒí•˜ì„¸ìš”.</option>
                        <option value="Y">Y</option>
                        <option value="N">N</option>
                    </select>
                </td>
                <th>ì²­ì‚°ì¼ì</th>
                <td><input type="date" class="form-control" name="liquidationDate" readonly></td>
            </tr>
            <tr>
                <th>ì„¸ë¶€ì¡°í•©ëª…</th>
                <td colspan="2"><input type="text" class="form-control" name="fundNameDetail" readonly></td>
                <th>ì¡°í•©ëª…</th>
                <td><input type="text" class="form-control" name="fundName" readonly></td>
                <th>ì„¤ë¦½ì¼ì</th>
                <td><input type="date" class="form-control" name="establishmentDate" readonly></td>
            </tr>
            <tr>
                <th>ì¡´ì†ê¸°ê°„(ë…„)</th>
                <td colspan="2"><input type="number" class="form-control" name="duration" readonly></td>
                <th>ì¡´ì†ê¸°ê°„ ì‹œì‘ì¼</th>
                <td><input type="date" class="form-control" name="durationStartDate" readonly></td>
                <th>ì¡´ì†ê¸°ê°„ ì¢…ë£Œì¼</th>
                <td><input type="date" class="form-control" name="durationEndDate" readonly></td>
            </tr>
            <tr>
                <th>íˆ¬ìê¸°ê°„(ë…„)</th>
                <td colspan="2"><input type="number" class="form-control" name="investmentDuration" readonly></td>
                <th>íˆ¬ìê¸°ê°„ ì‹œì‘ì¼</th>
                <td><input type="date" class="form-control" name="investmentStartDate" readonly></td>
                <th>íˆ¬ìê¸°ê°„ ì¢…ë£Œì¼</th>
                <td><input type="date" class="form-control" name="investmentEndDate" readonly></td>
            </tr>
            <tr>
                <th>ì•½ì • ì´ì•¡</th>
                <td colspan="2"><input type="number" class="form-control" name="committedTotalPrice" readonly></td>
                <th>1ì¢Œë‹¹ ê¸ˆì•¡</th>
                <td colspan="3"><input type="number" class="form-control" name="unitPrice" readonly></td>
            </tr>
            <tr>
                <th>íˆ¬ìê¸°êµ¬ ìœ í˜•</th>
                <td colspan="2">
                    <select class="form-control" name="fundOrganizationType" disabled>
                        <option value="">ì„ íƒí•˜ì„¸ìš”.</option>
                        <option value="ê°œì¸íˆ¬ìì¡°í•©">ê°œì¸íˆ¬ìì¡°í•©</option>
                        <option value="ë²¤ì²˜íˆ¬ìì¡°í•©">ë²¤ì²˜íˆ¬ìì¡°í•©</option>
                    </select>
                </td>
                <th>ë‚©ì…ë°©ë²•</th>
                <td colspan="3">
                    <select class="form-control" name="paymentType" disabled>
                        <option value="">ì„ íƒí•˜ì„¸ìš”.</option>
                        <option value="ìˆ˜ì‹œë‚©">ìˆ˜ì‹œë‚©</option>
                        <option value="ì¼ì‹œë‚©">ì¼ì‹œë‚©</option>
                    </select>
                </td>
            </tr>
            <tr>
                <th>ìš´ìš©ì¸ë ¥ ì „ì›</th>
                <td colspan="6"><input type="text" class="form-control" name="currentStaff" readonly></td>
            </tr>
            <tr>
                <th>íšŒê³„ê°ì‚¬ì¸ëª…</th>
                <td colspan="2"><input type="text" class="form-control" name="auditorName" readonly></td>
                <th>íšŒê³„ê°ì‚¬ì¸ ë³€ê²½ì¼ì</th>
                <td colspan="3"><input type="date" class="form-control" name="auditorDate" readonly></td>
            </tr>
            <tr>
                <th>ì—…ë¬´ìˆ˜íƒë²•ì¸</th>
                <td colspan="2"><input type="text" class="form-control" name="trusteeCorporation" readonly></td>
                <th>ì‚¬ë¬´ìˆ˜íƒë²•ì¸</th>
                <td colspan="3"><input type="text" class="form-control" name="administrationCorporation" readonly></td>
            </tr>

            <tr><th colspan="7">íˆ¬ìì¡°í•© ë³´ìˆ˜ì¡°ê±´</th></tr>
            <tr>
                <th>ê¸°ì¤€ìˆ˜ìµë¥ (%)</th>
                <td colspan="2"><input type="number" step="0.01" class="form-control" name="targetReturnRate" readonly></td>
                <th>ì„±ê³¼ë³´ìˆ˜ìœ¨(%)</th>
                <td colspan="3"><input type="number" step="0.01" class="form-control" name="performanceFeeRate" placeholder="ì—†ì„ ê²½ìš° 0.0%" readonly></td>
            </tr>
            <tr>
                <th>íˆ¬ìê¸°ê°„ ê´€ë¦¬ë³´ìˆ˜(%)</th>
                <td colspan="2"><input type="number" step="0.01" class="form-control" name="managementFeeInvestmentPeriod" readonly></td>
                <th>ìš´ì˜ê¸°ê°„ ê´€ë¦¬ë³´ìˆ˜(%)</th>
                <td colspan="3"><input type="number" step="0.01" class="form-control" name="managementFeeManagementPeriod" readonly></td>
            </tr>
            <tr>
                <th>ì¸ì„¼í‹°ë¸Œ ì¡°ê±´</th>
                <td colspan="6"><input type="text" class="form-control" name="incentiveCondition" readonly></td>
            </tr>
            <tr>
                <th>ìš°ì„ ì†ì‹¤ì¶©ë‹¹ GP</th>
                <td colspan="6"><input type="text" class="form-control" name="priorLossGP" readonly></td>
            </tr>
            <tr>
                <th>ìš°ì„ ì†ì‹¤ì¶©ë‹¹ LP</th>
                <td colspan="6"><input type="text" class="form-control" name="priorLossLP" readonly></td>
            </tr>
            <tr><th colspan="7">íˆ¬ìì¡°í•© ì˜ë¬´íˆ¬ìì¡°ê±´ - ì£¼ëª©ì /íŠ¹ìˆ˜ëª©ì  íˆ¬ìì¡°ê±´</th></tr>
            <tr>
                <th>ì˜ë¬´íˆ¬ì 1</th>
                <td colspan="2"><input type="text" class="form-control" name="mandatoryInvestment1" readonly></td>
                <th>ì˜ë¬´íˆ¬ì 2</th>
                <td colspan="3"><input type="text" class="form-control" name="mandatoryInvestment2" readonly></td>
            </tr>
            <tr>
                <th>ì£¼ëª©ì íˆ¬ì 1</th>
                <td colspan="2"><input type="text" class="form-control" name="primaryInvestment1" readonly></td>
                <th>ì£¼ëª©ì íˆ¬ì 2</th>
                <td colspan="3"><input type="text" class="form-control" name="primaryInvestment2" readonly></td>
            </tr>
            <tr>
                <th>íŠ¹ìˆ˜ëª©ì íˆ¬ì 1</th>
                <td colspan="2"><input type="text" class="form-control" name="specialPurposeInvestment1" readonly></td>
                <th>íŠ¹ìˆ˜ëª©ì íˆ¬ì 2</th>
                <td colspan="3"><input type="text" class="form-control" name="specialPurposeInvestment2" readonly></td>
            </tr>
            <tr>
                <th>íŠ¹ìˆ˜ëª©ì íˆ¬ì 3</th>
                <td colspan="2"><input type="text" class="form-control" name="specialPurposeInvestment3" readonly></td>
                <th>íŠ¹ìˆ˜ëª©ì íˆ¬ì ê¸°íƒ€</th>
                <td colspan="3"><input type="text" class="form-control" name="specialPurposeInvestment4" readonly></td>
            </tr>
            </tbody>

            <!-- íˆ¬ìì¡°í•©ì› ëª…ë¶€ -->
            <thead>
            <tr><th colspan="7">íˆ¬ìì¡°í•© ì¡°í•©ì› ëª…ë¶€</th></tr>
            <tr>
                <th>ì¡°í•©ì›</th>
                <th>ì¡°í•©ì›ìœ í˜•</th>
                <th>ì¶œìì•½ì •ì•¡</th>
                <th>ì—°ë½ì²˜</th>
                <th>ì£¼ì†Œ</th>
                <th>ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸</th>
                <th>ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸</th>
            </tr>
            </thead>
            <tbody id="fundMembersTable"></tbody>



        </table>


    </div>
</div>


</body>
</html>
