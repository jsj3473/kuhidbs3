<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>신규조합등록</title>

    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
    <script defer th:src="@{/js/bootstrap.bundle.min.js}"></script>
    <link rel="stylesheet" th:href="@{/css/datatables-custom.css}">
    <link rel="stylesheet" th:href="@{/css/sidebar.css}">
    <link rel="stylesheet" th:href="@{/css/navbar.css}">
    <link rel="stylesheet" th:href="@{/css/slimTable.css}">
    <script th:src="@{/js/common.js}"></script>
    <script defer th:src="@{/js/searchModal.js}"></script>

    <script defer>
        document.addEventListener("DOMContentLoaded", function () {
            const fundForm = document.getElementById("fundForm");
            const memberLink = document.getElementById("memberLink");
            let fundId = null;

            fundForm.addEventListener("submit", function (event) {
                event.preventDefault();
                fundId = document.getElementById("fundId").value.trim();
                console.log("fundId", fundId);
                if (!fundId) {
                    alert("조합 고유번호를 입력하세요.");
                    return;
                }
                const formData = new FormData(fundForm);
                fetch("/api/funds/createFund", {
                    method: "POST",
                    body: formData
                })
                    .then(response => {
                        if (response.ok) {
                            alert("저장이 완료되었습니다. 조합원 명부를 등록하세요.");
                            memberLink.href = "#";
                            window.scrollTo(0, 0);

                            memberLink.style.pointerEvents = "auto"; // 클릭 가능
                            memberLink.style.color = "#007bff"; // 파란색 활성화
                        } else {
                            alert("저장 실패. 다시 시도해주세요.");
                        }
                    })
                    .catch(error => {
                        console.error("에러 발생:", error);
                        alert("서버 오류 발생. 관리자에게 문의하세요.");
                    });
            });

            // 팝업 열기 함수
            window.openPopup = function (type) {
                if (!fundId) {
                    alert("먼저 조합정보를 저장한 후 입력을 진행하세요.");
                    return;
                }

                let url = type === "이동할 페이지"
                    ? `/fundAdd/member/${fundId}`
                    : `/fundAdd/member/${fundId}`;

                window.open(url, "popupWindow", "width=1000,height=600,scrollbars=yes");
            };
        });
    </script>

</head>
<body>
<div th:replace="fragments/navbar :: navbar"></div>
<div th:replace="fragments/searchModal :: searchModal"></div>

<div class="wrapper">

    <!-- 📌 좌측 사이드바 -->
    <nav class="sidebar">
        <a href="#" id="memberLink" onclick="openPopup('member')">👤 조합원명부 등록</a>
    </nav>

    <div class="content">
        <h2>조합 정보 입력</h2>
        <form id="fundForm" th:action="@{/api/funds/createFund}" method="post">
            <table class="table table-bordered text-center">
                <tbody>
                <tr><th colspan="7">투자조합 고유정보</th></tr>
                <tr>
                    <th>조합 고유번호</th>
                    <td colspan="2"><input type="text" class="form-control" name="fundId" id="fundId" required></td>
                    <th>청산여부</th>
                    <td>
                        <select class="form-control" name="liquidationStatus">
                            <option value="">선택하세요</option>
                            <option value="Y">Y</option>
                            <option value="N">N</option>
                        </select>
                    </td>
                    <th>청산일자</th>
                    <td><input type="date" class="form-control" name="liquidationDate"></td>
                </tr>
                <tr>
                    <th>세부조합명</th>
                    <td colspan="2"><input type="text" class="form-control" name="fundNameDetail"></td>
                    <th>조합명</th>
                    <td><input type="text" class="form-control" name="fundName"></td>
                    <th>설립일자</th>
                    <td><input type="date" class="form-control" name="establishmentDate"></td>
                </tr>
                <tr>
                    <th>존속기간(년)</th>
                    <td colspan="2"><input type="number" class="form-control" name="duration"></td>
                    <th>존속기간 시작일</th>
                    <td><input type="date" class="form-control" name="durationStartDate" required></td>
                    <th>존속기간 종료일</th>
                    <td><input type="date" class="form-control" name="durationEndDate" required></td>
                </tr>
                <tr>
                    <th>투자기간(년)</th>
                    <td colspan="2"><input type="number" class="form-control" name="investmentDuration"></td>
                    <th>투자기간 시작일</th>
                    <td><input type="date" class="form-control" name="investmentStartDate"></td>
                    <th>투자기간 종료일</th>
                    <td><input type="date" class="form-control" name="investmentEndDate"></td>
                </tr>
                <tr>
                    <th>약정 총액</th>
                    <td colspan="2"><input type="number" class="form-control" name="committedTotalPrice"></td>
                    <th>1좌당 금액</th>
                    <td colspan="3"><input type="number" class="form-control" name="unitPrice"></td>
                </tr>
                <tr>
                    <th>투자기구 유형</th>
                    <td colspan="2">
                        <select class="form-control" name="fundOrganizationType">
                            <option value="">선택하세요</option>
                            <option value="개인투자조합">개인투자조합</option>
                            <option value="벤처투자조합">벤처투자조합</option>
                        </select>
                    </td>
                    <th>납입방법</th>
                    <td colspan="3">
                        <select class="form-control" name="paymentType">
                            <option value="">선택하세요</option>
                            <option value="수시납">수시납</option>
                            <option value="일시납">일시납</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <th>운용인력 전원</th>
                    <td colspan="6"><input type="text" class="form-control" name="currentStaff"></td>
                </tr>
                <tr>
                    <th>회계감사인명</th>
                    <td colspan="2"><input type="text" class="form-control" name="auditorName"></td>
                    <th>회계감사인 변경일자</th>
                    <td colspan="3"><input type="date" class="form-control" name="auditorDate"></td>
                </tr>
                <tr>
                    <th>업무수탁법인</th>
                    <td colspan="2"><input type="text" class="form-control" name="trusteeCorporation"></td>
                    <th>사무수탁법인</th>
                    <td colspan="3"><input type="text" class="form-control" name="administrationCorporation"></td>
                </tr>

                <tr><th colspan="7">투자조합 보수조건</th></tr>
                <tr>
                    <th>기준수익률(%)</th>
                    <td colspan="2"><input type="number" step="0.01" class="form-control" name="targetReturnRate"></td>
                    <th>성과보수율(%)</th>
                    <td colspan="3"><input type="number" step="0.01" class="form-control" name="performanceFeeRate" placeholder="없을 경우 0.0%"></td>
                </tr>
                <tr>
                    <th>투자기간 관리보수(%)</th>
                    <td colspan="2"><input type="number" step="0.01" class="form-control" name="managementFeeInvestmentPeriod"></td>
                    <th>운영기간 관리보수(%)</th>
                    <td colspan="3"><input type="number" step="0.01" class="form-control" name="managementFeeManagementPeriod"></td>
                </tr>
                <tr>
                    <th>인센티브 조건</th>
                    <td colspan="6"><input type="text" class="form-control" name="incentiveCondition"></td>
                </tr>
                <tr>
                    <th>우선손실충당 GP</th>
                    <td colspan="6"><input type="text" class="form-control" name="priorLossGP"></td>
                </tr>
                <tr>
                    <th>우선손실충당 LP</th>
                    <td colspan="6"><input type="text" class="form-control" name="priorLossLP"></td>
                </tr>
                </tbody>
            </table>
            <div class="button-container text-end">
                <button type="submit" class="btn btn-primary">저장</button>
            </div>
        </form>
    </div>
</div>


</body>
</html>
