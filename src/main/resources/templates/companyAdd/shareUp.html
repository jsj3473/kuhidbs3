<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>감액/복원 입력</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
    <style>
        .container {
            max-width: 600px;
            margin: 20px auto;
        }
        label {
            font-weight: bold;
        }
    </style>
</head>

<body>
<div class="container">
    <h2 class="text-center">감액/복원 입력</h2>

    <form id="combineForm">
        <input type="hidden" name="companyId" th:value="${companyId}">
        <input type="hidden" name="investmentId" th:value="${investmentId}">

        <div class="mb-3">
            <label for="shareUpdateType" class="form-label">감액/복원</label>
            <select class="form-select" id="shareUpdateType" name="shareUpdateType" required>
                <option value="감액">감액</option>
                <option value="환입">환입</option>
            </select>
        </div>

        <div class="mb-3">
            <label for="shareUpdateDate" class="form-label">변동 일자</label>
            <input type="date" class="form-control" id="shareUpdateDate" name="shareUpdateDate" required>
        </div>

        <div class="mb-3">
            <label for="shareUnitValue" class="form-label">주당 가치</label>
            <input type="number" class="form-control" id="shareUnitValue" name="shareUnitValue" required>
        </div>

        <div class="mb-3">
            <label for="shareUpdateReason" class="form-label">사유</label>
            <textarea class="form-control" id="shareUpdateReason" name="shareUpdateReason" rows="3"></textarea>
        </div>

        <div class="mb-3">
            <label for="shareUpdateAction" class="form-label">조치 사항</label>
            <textarea class="form-control" id="shareUpdateAction" name="shareUpdateAction" rows="2"></textarea>
        </div>

        <div class="text-center">
            <button type="submit" class="btn btn-primary">등록</button>
        </div>
    </form>
</div>

<!-- JavaScript -->
<script>
    document.getElementById("combineForm").addEventListener("submit", function(event) {
        event.preventDefault(); // 기본 제출 방지

        let form = document.getElementById("combineForm");
        let formData = new FormData(form);
        let jsonData = {};

        // FormData를 JSON 객체로 변환
        formData.forEach((value, key) => {
            jsonData[key] = value;
        });

        console.log("전송할 데이터:", jsonData); // 디버깅용

        fetch("/api/companies/createShrup", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(jsonData)
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error("등록 실패");
                }
                return response.text();
            })
            .then(data => {
                alert("등록이 완료되었습니다!"); // ✅ 얼럿창 띄우기
                form.reset(); // 폼 초기화
            })
            .catch(error => {
                alert("오류 발생: " + error.message);
            });
    });
</script>

<!-- Bootstrap JS -->
<script th:src="@{/js/bootstrap.bundle.min.js}"></script>
</body>
</html>
