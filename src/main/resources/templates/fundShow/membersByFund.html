<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>조합원 구성</title>
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
    <script defer th:src="@{/js/bootstrap.bundle.min.js}"></script>
    <link rel="stylesheet" th:href="@{/css/slimTable.css}">
    <link rel="stylesheet" th:href="@{/css/common.css}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

</head>
<body class="container mt-4">

<h2 class="mb-4">조합원 구성</h2>

<!-- 조합 ID 정보 -->
<!--<p style="display: none;"><strong>조합 ID:</strong> <span th:text="${fundId}"></span></p>-->

<!-- ✅ 조합원 테이블 -->
<table class="table table-bordered text-center">
    <thead>
    <tr>
        <th rowspan="2">조합원명</th>
        <th colspan="2">출자약정액</th>
        <th colspan="4">배분액</th>
        <th rowspan="1">출자잔액</th>
        <th rowspan="2">조합원유형</th>
        <th rowspan="1">배분순위</th>
    </tr>
    <tr>
        <th>금액</th>
        <th>비율</th>
        <th>원금</th>
        <th>이익</th>
        <th>총액</th>
        <th>비율</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="member : ${rMemtypeDTOS}">
        <td th:text="${member.memberName}"></td>
        <td th:text="${#numbers.formatInteger(member.committedUnitPrice, 3, 'COMMA')} + ' 원'"></td>
        <td th:text="${#numbers.formatDecimal(member.contributionRate ?: 0, 1, 2, 'POINT')} + ' %'"></td>

        <!-- 배분 원금 * 출자비율 -->
        <td th:text="${#numbers.formatInteger(((fund.allocPrincipal ?: 0) * (member.contributionRate ?: 0) / 100), 3, 'COMMA')} + ' 원'"></td>

        <!-- 배분 이익 * 출자비율 -->
        <td th:text="${#numbers.formatInteger(((fund.allocProfit ?: 0) * (member.contributionRate ?: 0) / 100), 3, 'COMMA')} + ' 원'"></td>

        <!-- 배분 총액 * 출자비율 -->
        <td th:text="${#numbers.formatInteger(((fund.allocTotal ?: 0) * (member.contributionRate ?: 0) / 100), 3, 'COMMA')} + ' 원'"></td>

        <td>-</td>
        <td>-</td>
        <td th:text="${member.memberType}"></td>
        <td>-</td>
    </tr>


    </tbody>
    <tfoot>
    <tr>
        <th>합계</th>
        <td  th:text="${fund.getCommittedTotalPrice()}"></td> <!-- 출자 총액 -->
        <td >100 %</td> <!-- 출자 비율 총합 -->

        <!-- 배분 원금, 배분 이익, 배분 총액 -->
        <td th:text="${#numbers.formatInteger(fund.allocPrincipal, 3, 'COMMA')}">0</td>
        <td th:text="${#numbers.formatInteger(fund.allocProfit, 3, 'COMMA')}">0</td>
        <td th:text="${#numbers.formatInteger(fund.allocTotal, 3, 'COMMA')}">0</td>

        <!-- 배분 비율 (배분 총액 / 출자 총액 * 100) -->
        <td th:text="${fund.getCommittedTotalPrice() != 0 ? #numbers.formatDecimal(fund.allocTotal / fund.getCommittedTotalPrice() * 100, 1, 2, 'POINT') + ' %' : '0 %'}"></td>

        <th></th>
        <th></th>
        <th></th>
    </tr>

    </tfoot>
</table>

</body>
</html>


<script>
    document.addEventListener("DOMContentLoaded", function() {
        let totalPrice = 0;
        let totalRate = 0;

        document.querySelectorAll(".committedUnitPrice").forEach(td => {
            let value = parseInt(td.innerText.replace(/[^0-9]/g, "")) || 0;
            totalPrice += value;
        });

        document.querySelectorAll(".contributionRate").forEach(td => {
            let value = parseFloat(td.innerText.replace(/[^0-9.]/g, "")) || 0;
            totalRate += value;
        });

        document.getElementById("totalCommittedUnitPrice").innerText = totalPrice.toLocaleString() + " 원";
        document.getElementById("totalContributionRate").innerText = totalRate.toFixed(2) + " %";
    });
</script>
